---
import { languages } from "../i18n/ui";
import { getLangFromUrl } from "../i18n/utils";

const currentLang = getLangFromUrl(Astro.url);

// Get the path relative to the current language
// e.g. /gl/modulos -> modulos
// e.g. /es -> ""
const pathParts = Astro.url.pathname.split('/').filter(p => p);
const langKeys = Object.keys(languages);

// Remove the language part if it matches a known language
if (pathParts.length > 0 && langKeys.includes(pathParts[0])) {
    pathParts.shift();
}
const currentSlug = pathParts.join('/');
---

<div class="lang-switcher">
  {
    Object.entries(languages).map(([lang, label]) => {
      const href = `/${lang}${currentSlug ? '/' + currentSlug : ''}`;
      return (
        <a
          href={href}
          class:list={["lang-button", { active: lang === currentLang }]}
        >
          {label}
        </a>
      );
    })
  }
</div>

<style>
  .lang-switcher {
    position: fixed; /* Stay on screen */
    top: 1rem;
    right: 1rem;
    z-index: 100;
    display: flex;
    gap: 0.5rem;
  }
  .lang-button {
    background-color: transparent;
    border: 1px solid var(--color-accent-2);
    color: var(--color-accent-2);
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    cursor: pointer;
    font-family: var(--font-family-body);
    opacity: 0.7;
    transition: all 0.2s ease;
  }
  .lang-button:hover {
    opacity: 1;
    background-color: var(--color-accent-2);
    color: var(--color-base);
  }
  .lang-button.active {
    opacity: 1;
    background-color: var(--color-accent-1);
    border-color: var(--color-accent-1);
    color: var(--color-base);
  }

  /* ===== RESPONSIVE MÃ“VILES ===== */
  @media (max-width: 768px) {
    .lang-switcher {
      top: 0.5rem;
      right: 0.5rem;
      gap: 0.35rem;
    }
    .lang-button {
      padding: 0.2rem 0.5rem;
      font-size: 0.85rem;
    }
  }

  @media (max-width: 480px) {
    .lang-switcher {
      top: 0.35rem;
      right: 0.35rem;
      gap: 0.25rem;
    }
    .lang-button {
      padding: 0.15rem 0.4rem;
      font-size: 0.75rem;
    }
  }
</style>
